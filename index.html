document.getElementById('imgInput').addEventListener('change', function(e) {
  const files = Array.from(e.target.files);
  files.forEach(file => {
    const reader = new FileReader();
    reader.onload = function(evt) {
      fabric.Image.fromURL(evt.target.result, function(img) {
        const scale = Math.min(370 / img.width, 320 / img.height);
        img.set({
          left: 0,
          top: 0,
          scaleX: scale,
          scaleY: scale,
          selectable: true,
          hasBorders: true,
          hasControls: true,
          objectCaching: false // 🔸枠のズレ防止
        });
        img.setCoords(); // 🔸バウンディングボックス再計算

        layers.push(img);
        canvas.add(img);
        addLayerThumb(img, evt.target.result);
        canvas.setActiveObject(img);
        canvas.requestRenderAll();
      }, { crossOrigin: 'anonymous' });
    };
    reader.readAsDataURL(file);
  });
});
